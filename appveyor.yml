environment:
  DevMyGetApiKey:
    secure: irzUE0TW1t0PaM/FtieoJK1Uq/7ZXUw4qEUea1wX7LpwXRx1xeUTXEo4spxBVN6c
  MyGetApiKey:
    secure: irzUE0TW1t0PaM/FtieoJK1Uq/7ZXUw4qEUea1wX7LpwXRx1xeUTXEo4spxBVN6c

# Set-ItemProperty is a workaround :
# A command that prompts the user failed because the host program or the command type does not support user interaction.
# Même session PS pour Install et Build
install:
  - ps: |
          Set-ItemProperty -Name DisablePromptToUpdateHelp -Value 1 -path 'HKLM:\SOFTWARE\Microsoft\PowerShell'

          #nouvelle session pour installer PowershellGet
          PowerShell.exe -Command {
            Install-PackageProvider Nuget -ForceBootstrap -Force > $null
            Set-PSRepository -Name PSGallery -InstallationPolicy Trusted
            # La version livrée avec PS ne provient pas d'un repository,
            # on force l'installation à partir de PS Gallery
            Install-module PowershellGet -MinimumVersion 1.1.0.0 -Force -Scope AllUsers
            Export-Clixml -InputObject $Profile -Path  $env:temp\PSProfile.xml      }

nuget:
  account_feed: true
  project_feed: true

build_script:
   - ps: |

         $Profile=Import-Clixml $env:temp\PSProfile.xml
         Install-Module Psake  -force
         Import-Module Psake
         . '.\Install.ps1'
         Write-Host "Call Publish task"
                                #todo type release/debug ?
         . '.\Publish.ps1' -Dev #todo repo name ?



